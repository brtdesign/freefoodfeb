<!DOCTYPE html>
<html lang="en" class="no-js">
<meta charset="utf-8">
<script>
    document.documentElement.className = document.documentElement.className.replace("no-js","js");
</script>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href='//fonts.googleapis.com/css?family=Sorts+Mill+Goudy%7COpen+Sans:300,600:latin%7CSource+Sans+Pro:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="assets/css/default.css" type="text/css">


</head>
   <body>

      <div class="wrapper">
      <h1 class="fff-header">
       <!-- need to fix this onerror'ing as a generic -->
        <img src="assets/images/svg/fff-header.svg" onerror="this.onerror=null; this.src='image.png'" alt="Free Food February">
       </h1>
     <nav class="navigation" role="navigation"><a href="themes" id="js-themes-nav"><b>&larr;</b> Show all themes</a></nav>


            <div class="theme__holder loading">
              <section class="theme__card theme__card--one"><h1 class="theme__card__header">come slim with me</h1>
                  <a href="menus/valentines.html" class="theme__card__link">
                      <img src="assets/images/invites/thumb1.jpg" class="theme__card__image">
                  </a>
              </section>
              <section class="theme__card theme__card--two"><h1 class="theme__card__header">Fakeaway treat night</h1>
                  <a href="#slim-with-me" class="theme__card__link">

                      <img src="assets/images/invites/thumb2.jpg" class="theme__card__image">

                  </a>
              </section>
              <section class="theme__card theme__card--three"><h1 class="theme__card__header">hangover party</h1>
                  <a href="#slim-with-me" class="theme__card__link">

                      <img src="assets/images/invites/thumb3.jpg" class="theme__card__image">

                  </a>
              </section>
              <section class="theme__card theme__card--four"><h1 class="theme__card__header">Valentines dinner</h1>
                  <a href="valentines.html" class="theme__card__link">

                      <img src="assets/images/invites/thumb4.jpg" class="theme__card__image">

                  </a>
              </section>
              <section class="theme__card theme__card--five"><h1 class="theme__card__header">budget party</h1>
                  <a href="#slim-with-me" class="theme__card__link">

                      <img src="assets/images/invites/thumb1.jpg" class="theme__card__image">

                  </a>
              </section>
              <section class="theme__card theme__card--six"><h1 class="theme__card__header">Sunday lunch</h1>
                  <a href="#slim-with-me" class="theme__card__link">

                      <img src="assets/images/invites/thumb2.jpg" class="theme__card__image">

                  </a>
              </section>
              <section class="theme__card theme__card--seven"><h1 class="theme__card__header">Chinese banquet</h1>
                  <a href="#slim-with-me" class="theme__card__link">

                      <img src="assets/images/invites/thumb3.jpg" class="theme__card__image">

                  </a>
              </section>
              <section class="theme__card theme__card--eight"><h1 class="theme__card__header">theme eight</h1>
                  <a href="#slim-with-me" class="theme__card__link">

                      <img src="assets/images/invites/thumb4.jpg" class="theme__card__image">

                  </a>
              </section>
              <section class="theme__card theme__card--nine"><h1 class="theme__card__header">theme nine</h1>
                  <a href="#slim-with-me" class="theme__card__link">
                      <img src="assets/images/invites/thumb1.jpg" class="theme__card__image">
                  </a>
              </section>
              <section class="theme__card theme__card--ten"><h1 class="theme__card__header">theme ten</h1>
                  <a href="#slim-with-me" class="theme__card__link">
                      <img src="assets/images/invites/thumb2.jpg" class="theme__card__image">
                  </a>
              </section>

           </div>
       </div>
   </body>
   <!-- need to concat these -->
   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
   <script src="assets/js/libs/jquery.arctext.js"></script>
   <script src="assets/js/libs/imagesloaded.min.js"></script>
   <script src="assets/js/libs/masonry.min.js"></script>
   <script src="assets/js/libs/jquery.transit.min.js"></script>

   <script>

/* ######################################################

Doc ready functions

#######################################################*/

$(document).ready(function() {
       setupMasonary();
       $('.theme__holder').removeClass('loading');
       $('.theme__card__header').arctext({radius: 280});

    // click event listener for the individual cards
       themeListener();
}); // close $ready

/* ######################################################

Instantiate masonary

#######################################################*/

setupMasonary=function(){
   // arrange items using masonary
    var $container = $('.theme__holder');
    $container.imagesLoaded( function() {
        $container.masonry({
          itemSelector: '.theme__card'
            });
        });
   };



/* ######################################################

Event listeners for clicks on the thumb cards

#######################################################*/

themeListener = function(){
    // listener on navigation item
    $('#js-themes-nav').click(function(event){
        event.preventDefault();
        // remove the menu thats showing
        removeThemePage();
        // fade in the thumbnails

    });

    // click event listeners on the theme cards
    $('.theme__card__link').click(function(event){
        event.preventDefault();
        $(this).addClass('visited');
        fadeCard($(this).parent(), '0.5', '0'); // force this one as we want it to dissapear immediately
        var pageToLoad=($(this)).attr('href');
        fadeAllThumbs('out', pageToLoad); // can be in or out#

        //load the main theme page, consisting of a menu with links to recipes
    });
};


/* ######################################################

The animations for cards fading in and out

#######################################################*/

// function to animate opacity and scale
fadeCard = function(elem, cardScale, cardOpacity){
    elem.transition({ // requires transit.js
    scale:cardScale,
    opacity:cardOpacity,
//    rotateY: '360deg'
    },
    275,
    'easeOutSine'
    )
}

/* ######################################################

Fade in or out the theme card thumbs

#######################################################*/

fadeAllThumbs=function(inOrOut, pageToLoad){
    // some basic vars dependent on wether we are going in or out
    if  (inOrOut=='out'){
        var cardScale="0.5";
        var cardOpacity="0";
        var navOpacity="1";
        var navPosition="-16px"; // matches the original value set in css. not very maintainable
        var delayNav="1850"; // we want the nav to delay when its sliding in, but not if its sliding out
    } else {
        var cardScale="1";
        var cardOpacity="1";
        var navOpacity="0";
        var navPosition="-172px";
        var delayNav="0"; // start immediately if its been clicked to fade the thumbs back in
    }


    //loop through the thumbs and fade them in or out
        $.each(cardArray, function(i, val) {
            setTimeout(function() {
                fadeCard($(val), cardScale, cardOpacity);


            // if we're on the last card, start to bring in the menu
            if ((i+1)==cardArray.length && inOrOut=='out'){

               loadThemePage(pageToLoad);
            }

            }, (i+1) * 125);

            // check if were at the last card
            console.log('i:'+i, 'num cards:'+cardArray.length);


        });


    // fade + slide the nav in or out
    setTimeout(function() {
    $('#js-themes-nav').transition({
            opacity:navOpacity,
            left:navPosition,
        }, 350); // animation timing
    }, delayNav); // delay start timing, should be 0 when this is fading out so it responds immediately to click
};

/* ######################################################

loadThemePage: main theme page with menu and link to recipes

#######################################################*/

loadThemePage=function(whichPage){

   // Create a holder with loading text. Create this here so we can have a nice loading function.
   // $('#results').append('<section class="fff-panel loading" id="json-'+whichPage+'">loading&hellip;</section>');

    var pageToLoad=whichPage + ' .menu';

$('.theme__holder').append('<div class="menu__holder"></div>'); // this will get deleted when we dont need it


   $('.menu__holder').load(pageToLoad, function(){
            $('.menu__card__header').arctext({radius: 720});
            $('.menu').transition({
                opacity:1,
                visibility:'visible',
                rotate:'-3deg',
            }, 550)
    });
};



removeThemePage=function(){

    $('.menu').transition({
        opacity:0,
        visibility:'hidden',
         rotate:'3deg',
    }, 225, function(){
         $('.menu__holder').remove(); // delete the holder, it gets recreated
        fadeAllThumbs('in');
    });



}



/* ######################################################

Define the array for the them cards - doesnt seem to work on $ready

#######################################################*/

    // store all the card onjects in an array, we loop through them later to create the sequential animations etc
    var cards = $('.theme__card');
    var cardArray = $.makeArray(cards);

   </script>
</html>
